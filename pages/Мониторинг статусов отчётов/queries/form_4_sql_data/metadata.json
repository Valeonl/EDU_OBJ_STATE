{
  "gitSyncId": "679c9f7758291b51e15c9b3a_762d679d-4213-411b-a805-c72e44deb44a",
  "id": "Мониторинг статусов отчётов_form_4_sql_data",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "SELECT \nua.iogv,\nua.iogv_name,\nua.iogv_short_name,\nua.login,\nua.type_ou,\nua.agencyname,\ninn,\n\"number\",\nyears_of_use,\ntextbooks_written_off_2024,\nreason_number,\nCASE WHEN writeoff_reason = 'null' THEN '' ELSE writeoff_reason END AS writeoff_reason,\ntotal_writeoff_cost_thousands_rub,\nCASE \n        WHEN textbooks_written_off_2024 IS NULL\n         AND reason_number IS NULL\n         AND writeoff_reason IS NULL\n\t\t\t\t AND total_writeoff_cost_thousands_rub IS NULL\n        THEN true \n        ELSE false \n    END as isHidenRow\nFROM books_monitoring_app.form_4 form4\nLEFT JOIN access_control.user_auth ua\nON form4.inn = ua.login::bigint\nWHERE iogv = {{appsmith.store.superuser.login}}::BIGINT AND ua.is_report_required_book = true\n{{ appsmith.store.download_type === 'gov' \n    ? \"AND ua.type_ou NOT IN ('ЧОУ', 'АНОО', 'АНПО')\"\n    : appsmith.store.download_type === 'private' \n      ? \"AND ua.type_ou IN ('ЧОУ', 'АНОО', 'АНПО')\"\n      : \"\"\n}}\nAND ua.login::bigint IN (\n\tSELECT DISTINCT rsh.\"FK ИНН\"\n\tFROM books_monitoring_app.report_status_history rsh\n\tLEFT JOIN books_monitoring_app.report_status rs ON rsh.\"FK Статус\" = rs.key0\n\tWHERE rs.system_name NOT IN ('excluded')\n\tAND rsh.\"Дата статуса\" = (\n\t\tSELECT MAX(\"Дата статуса\")\n\t\tFROM books_monitoring_app.report_status_history\n\t\tWHERE \"FK ИНН\" = rsh.\"FK ИНН\"\n\t)\n)\nORDER BY ua.login,form4.\"number\"\n\n",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": false
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "Appsmith CAD Внутренний",
      "isAutoGenerated": false,
      "name": "Appsmith CAD",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "executeOnLoad": false,
    "name": "form_4_sql_data",
    "pageId": "Мониторинг статусов отчётов",
    "userSetOnLoad": false
  }
}