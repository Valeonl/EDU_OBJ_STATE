{
  "gitSyncId": "679c9f7758291b51e15c9b3a_4b8bd514-b1c0-49fa-9e89-224b2ca2c71c",
  "id": "Мониторинг статусов отчётов_form_3_sql_group_data",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "SELECT \n    ua.iogv,\n    ua.iogv_name,\n    ua.iogv_short_name,\n    course_subject,\n    class_spo,\n    SUM(student_count_2024_2025) as student_count_2024_2025,\n    SUM(projected_student_count) as projected_student_count,\n    SUM(textbooks_in_stock) as textbooks_in_stock,\n    SUM(additional_demand) as additional_demand,\n    TRIM('; ' FROM NULLIF(STRING_AGG(DISTINCT CASE \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t WHEN demand_reason_group = 'null' THEN '' \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t WHEN demand_reason_group IS NULL THEN ''\n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t ELSE demand_reason_group \n\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t END, '; '), '')) as demand_reason\nFROM books_monitoring_app.form_3 form3\nLEFT JOIN access_control.user_auth ua\nON form3.inn = ua.login::bigint\nWHERE iogv = {{appsmith.store.superuser.login}}::BIGINT \n    AND ua.is_report_required_book = true \n\t\t{{ appsmith.store.download_type === 'gov' \n? \"AND ua.type_ou NOT IN ('ЧОУ', 'АНОО', 'АНПО')\"\n: appsmith.store.download_type === 'private' \n? \"AND ua.type_ou IN ('ЧОУ', 'АНОО', 'АНПО')\"\n: \"\"\n}}\n    AND ua.login::bigint IN (\n\t\t\tSELECT DISTINCT rsh.\"FK ИНН\"\n\t\t\tFROM books_monitoring_app.report_status_history rsh\n\t\t\tLEFT JOIN books_monitoring_app.report_status rs \n\t\t\tON rsh.\"FK Статус\" = rs.key0\n\t\t\tWHERE rs.system_name NOT IN ('excluded')\n\t\t\tAND rsh.\"Дата статуса\" = (\n\t\t\t\tSELECT MAX(\"Дата статуса\")\n\t\t\t\tFROM books_monitoring_app.report_status_history\n\t\t\t\tWHERE \"FK ИНН\" = rsh.\"FK ИНН\"\n\t\t\t)\n\t\t)\nGROUP BY \n    ua.iogv,\n    ua.iogv_name,\n    ua.iogv_short_name,\n    class_spo,\t\t\n    course_subject\nORDER BY class_spo::bigint, course_subject",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": false
        }
      ],
      "timeoutInMillisecond": 10000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "Appsmith CAD",
      "isAutoGenerated": false,
      "name": "Appsmith CAD",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [
      {
        "key": "body"
      }
    ],
    "executeOnLoad": false,
    "name": "form_3_sql_group_data",
    "pageId": "Мониторинг статусов отчётов",
    "userSetOnLoad": false
  }
}